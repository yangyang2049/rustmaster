# 变更日志

## [未发布]

### 新增 (Added)
- **题库系统扩展**：支持三种题型（判断题、单选题、多选题）
  - 新增500+道Rust相关题目（150道判断题、250道单选题、100道多选题）
  - 更新QuizPage UI组件，支持不同题型的显示和交互
    - 判断题：显示True/False按钮
    - 单选题：单选选项
    - 多选题：多选选项，带复选框和提交按钮
    - 题目类型标签显示
    - 答案检查和反馈

### 修复 (Fixed)
- 修复QuizPage.ets中的ArkTS语法错误（@Builder函数中不能使用const声明）
- 修复UI组件嵌套问题，确保margin等属性正确应用

## [未发布]

### 新增 (Added)
- **语法速查扩展**：大幅扩展语法标签页内容，从 5 个分类增加到 20 个分类
  - 新增分类：所有权与借用、集合类型方法、迭代器方法、Option 和 Result、结构体和枚举、模块和可见性、泛型和 Trait、智能指针、并发编程、异步编程、错误处理、生命周期、常用类型转换、常用标准库类型
  - 每个分类包含多个常用语法、方法和 API 的速查条目
  - 总计超过 200 个语法速查条目，涵盖 Rust 编程的各个方面
- **课程系统扩展**：添加了 63 个 Rust 课程，涵盖从基础到高级的所有核心主题
  - 创建了 12 个课程单元，按主题组织：Rust 基础、所有权系统、复合数据类型、集合类型、错误处理、模块系统、泛型与 Trait、智能指针、并发编程、异步编程、高级特性、实战项目
  - 在 `RustTypes.ets` 中添加了 `CourseUnit` 接口定义
  - 在 `RustConstants.ets` 中创建了 `COURSE_UNITS` 数组和扩展的 `COURSE_CHAPTERS` 数组
  - 更新了 `LearnPage.ets`，支持按单元分组展示课程
  - 添加了单元展开/折叠功能
  - 显示每个单元的进度（已完成/总课程数）
  - 默认展开前两个单元

## [未发布]

### 新增 (Added)
- **Rust 大师应用完整迁移**：将 React/TypeScript 的 Rust 大师应用完整迁移到 HarmonyOS ArkTS
  - **设计系统**：创建统一的设计系统常量文件 `DesignSystem.ets`，包含间距、圆角、字体、阴影等设计规范
  - **颜色资源扩展**：添加 Rust 主题颜色（橙色系）到 base 和 dark 模式
  - **类型定义**：创建 `RustTypes.ets`，定义所有 TypeScript 接口对应的 ArkTS 类型
  - **数据常量**：创建 `RustConstants.ets`，迁移所有常量数据（课程、测验、速查、面试题等）
  - **主页面重构**：重构 `Index.ets`，实现 5 个 Tab 切换（学习、编辑器、测验、面试、设置）
  - **底部导航栏**：创建 `NavBar.ets` 组件，实现底部导航功能
  - **学习页面**：创建 `LearnPage.ets`，实现章节列表、详情、速查表、搜索功能
  - **编辑器页面**：创建 `EditorPage.ets` 和 `CodeEditor.ets`，实现代码编辑、运行、AI 功能
  - **测验页面**：创建 `QuizPage.ets`，实现答题流程、结果统计、进度追踪
  - **面试页面**：创建 `InterviewPage.ets`，实现搜索、展开、难度标签功能
  - **设置页面**：创建 `SettingsPage.ets`，实现学习档案、数据持久化
  - **Gemini 服务**：创建 `GeminiService.ets`，实现代码执行、解释、修复的 AI 功能（需要配置 API Key）

### 变更 (Changed)
- **应用名称和 Bundle ID 更新**：将应用名称改为 "Rust 从入门到放弃"，Bundle ID 改为 "com.douhua.rustmaster"
  - 更新了 AppScope/app.json5 中的 bundleName
  - 更新了 AppScope/resources/base/element/string.json 和 en_US/element/string.json 中的 app_name

## [未发布]

### 优化 (Optimized)
- **历史旗帜图片转换为 WebP 格式**：将 2951 张历史旗帜图片从 PNG 转换为 WebP
  - 转换前大小：91 MB
  - 转换后大小：34 MB
  - 节省空间：**57 MB**（减少约 63%）
  - 更新了 FlagHistoryPage 和 FlagDetailPage 中的图片引用

- **国徽图片转换为 WebP 格式**：将 198 张国徽图片从 PNG 转换为 WebP
  - 转换前大小：23 MB
  - 转换后大小：9.7 MB
  - 节省空间：**13.3 MB**（减少约 58%）
  - 更新了 coatOfArmsUtil 中的图片引用

- **国歌音频压缩优化**：将国歌音频比特率优化
  - Top 10 国家保持原比特率（美、英、法、德、中、俄、印、巴西、加、澳）
  - 其他 178 个国家压缩至 64kbps
  - 转换前大小：342 MB
  - 转换后大小：134 MB
  - 节省空间：**222 MB**（减少约 65%）

### 新增 (Added)
- **振动反馈功能**：为所有游戏添加触觉反馈
  - 创建了VibratorUtil工具类，使用HarmonyOS的vibrator API提供振动反馈（参考morse项目实现）
  - 支持四种振动类型：
    - **点击振动（tap）**：轻触反馈，50ms短振
    - **正确答案振动（correct）**：短促两次振动，表示答对
    - **错误答案振动（incorrect）**：中长振动250ms，表示答错
    - **胜利振动（win）**：三次短振，表示完成关卡
  - 为所有游戏页面集成振动反馈：
    - **QuizPlayPage**：选项点击、正确答案、错误答案、按钮点击、完成关卡
    - **MemoryPlayPage**：卡片点击、匹配成功、匹配失败、按钮点击、完成关卡
    - **TriviaPlayPage**：选项点击、正确答案、错误答案、按钮点击、完成关卡
    - **InputPlayPage**：提交答案、正确答案、错误答案、按钮点击、完成关卡
    - **FakeFlagPlayPage**：旗帜点击、正确答案、错误答案、按钮点击、完成关卡
  - 在"我"页面（ProfilePage）添加振动设置开关，默认启用
  - 振动设置使用Preferences持久化存储，可在设置中随时开启/关闭
- **所有游戏音效功能**：为所有游戏添加音效播放功能
  - 从flagame项目复制了14个音效文件（correct、incorrect、button、tap、success、congrats、over等）到rawfile/sfx目录
  - 创建了SoundEffectUtil工具类，使用HarmonyOS的SoundPool API播放音效（参考morse项目实现）
  - 为所有游戏页面集成音效播放：
    - **QuizPlayPage**：正确答案、错误答案、按钮点击、游戏完成、游戏失败
    - **MemoryPlayPage**：卡片匹配成功、匹配失败、游戏完成、游戏失败、按钮点击
    - **TriviaPlayPage**：正确答案、错误答案、按钮点击、游戏完成、游戏失败
    - **InputPlayPage**：正确答案、错误答案、按钮点击、游戏完成、游戏失败
    - **FakeFlagPlayPage**：正确答案、错误答案、按钮点击、游戏完成、游戏失败
    - **PaintPlayPage**：正确答案、错误答案、填色音效、提示音效、按钮点击、关卡完成
  - 所有页面初始化时自动初始化音效播放器，页面销毁时释放资源
  - 移除了轻触音效（tap），避免与结果音效混淆
- **移除游戏反馈Toast**：移除所有游戏页面中的反馈提示toast
  - 移除了TriviaPlayPage中的"✓ 正确!"和"✗ 错误"toast
  - 移除了InputPlayPage中的"✓ 正确!"和"✗ 答案不正确"toast
  - 保留音效反馈，提供更流畅的游戏体验
- **选项逐个出现动画**：为所有有选项的游戏添加选项逐个出现的动画效果
  - **QuizPlayPage**：选项和国旗选项逐个出现，每个选项延迟100ms，使用淡入和缩放动画
  - **TriviaPlayPage**：选项逐个出现，每个选项延迟100ms，使用淡入和缩放动画
  - **FakeFlagPlayPage**：国旗选项逐个出现，每个选项延迟100ms，使用淡入和缩放动画
  - 动画在题目加载和切换到下一题时自动触发，提升视觉体验

### 修复 (Fixed)
- **记忆游戏国旗翻转问题**：修复记忆游戏中卡片翻转时国旗也被翻转的问题
  - 对国旗图片应用反向旋转，抵消卡片容器的翻转效果
  - 确保国旗在卡片翻转时保持正常方向显示
- **朝鲜国歌错误修复**：修复朝鲜国歌文件错误的问题
  - 发现并删除了错误的朝鲜国歌文件（实际是苏联国歌）
  - 从Wikimedia Commons下载了正确的朝鲜国歌（Aegukka）OGG版本
  - 新文件大小：915KB（原错误文件：8.2MB）
  - 验证了代码已正确过滤缺失的国歌（不丹、阿曼、加蓬、几内亚比绍、多哥、东帝汶）

### 变更 (Changed)
- **游戏页面下一关优化**：所有quiz类游戏页面的"下一关"按钮改为在当前页面重新加载数据，而不是push到新页面
  - 修改了QuizPlayPage、TriviaPlayPage、InputPlayPage、FakeFlagPlayPage、MemoryPlayPage
  - 避免了导航栈过长的问题，提升用户体验
  - 添加了loadLevel方法来统一处理关卡数据的重新加载和状态重置
- **阿富汗历史国旗数据更新**：添加2021年当前国旗，删除1000年数据
  - 从flag folder复制af.svg并转换为PNG格式，保存为flag_history_af_2021.png
  - 在FlagHistoryData.ets中添加2021年的数据条目，标记为"当前"国旗
  - 删除1000年的历史数据条目和对应的PNG文件
- **画廊页面搜索提示优化**：在未找到匹配国家时添加提示文字
  - 在"未找到匹配的国家"下方添加较小的描述文字："修改关键词或选择"全部"或其他大洲"
  - 提示用户可以通过切换chip或修改搜索关键词来查找结果
- **历史国旗资源位置调整**：将所有历史国旗PNG文件移动到rawfile目录
  - 将所有历史国旗PNG文件从 `entry/src/main/resources/base/media/` 移动到 `entry/src/main/resources/rawfile/flag_history/`
  - 更新了 `FlagHistoryPage.ets` 和 `FlagDetailPage.ets`，使用 `$rawfile` 替代 `$r` 来加载历史国旗资源
  - 资源路径格式从 `app.media.flag_history_xx_yyyy` 改为 `flag_history/flag_history_xx_yyyy.png`
  - 更新了 `FLAG_HISTORY_USAGE.md` 文档中的路径说明
- **历史国旗banner优化**：
  - 标题行使用箭头图标（icon_arrow_right），完全复制涂鸦说明banner的样式
  - 整个历史国旗卡片区域可点击，点击后跳转到历史国旗详情页
  - 移除了历史国旗单元格中的年份文本，只显示国旗图片，界面更简洁
  - 移除了单个历史国旗项的点击事件，统一使用卡片点击跳转
- **历史国旗格式转换为PNG**：将所有历史国旗从SVG格式转换为PNG格式
  - 创建了转换脚本 `scripts/convert_flag_history_to_png.js`，使用sharp库将SVG转换为PNG
  - 成功转换2982个历史国旗文件为PNG格式（800x533像素，3:2比例）
  - 删除了所有原始SVG文件，确保只使用PNG格式
  - PNG文件保留在 `entry/src/main/resources/base/media/` 目录，使用 `$r('app.media.${imagePath}')` 加载
- **历史国旗标题添加箭头并支持点击跳转**：在历史国旗标题旁边添加右箭头图标
  - 完全复制涂鸦说明banner的箭头样式（icon_arrow_right），像素级保持一致
  - 整个历史国旗卡片区域可点击，点击后跳转到历史国旗详情页
  - 移除了单个历史国旗项的点击事件，统一使用卡片点击跳转
  - 箭头颜色自动适配明暗模式
- **历史国旗单元格优化**：移除历史国旗单元格中的年份文本，只显示国旗图片，界面更简洁
- **国旗详情页历史国旗显示优化**：优化历史国旗banner的显示
  - 历史国旗只显示一行，最多显示3个项目（前三个）
  - 移除了"查看全部"箭头按钮，界面更简洁
- **国徽资源位置调整**：将所有PNG格式的国徽文件移动到rawfile目录
  - 将198个PNG国徽文件从 `entry/src/main/resources/base/media/` 移动到 `entry/src/main/resources/rawfile/coat_of_arms/`
  - 更新了 `coatOfArmsUtil.ets`，使用 `$rawfile` 替代 `$r` 来加载国徽资源
  - 资源路径格式从 `app.media.coat_of_arms_xx` 改为 `coat_of_arms/coat_of_arms_xx.png`
  - 所有国徽文件（包括之前转换失败的kg、nl、rs）已全部完成转换并移动到rawfile目录
  - 将198个原始SVG国徽文件移动到项目根目录的 `coat of arms svg backup/` 文件夹作为备份
- **国徽格式转换为PNG**：将所有国徽从SVG格式转换为PNG格式
  - 创建了转换脚本 `scripts/convert_coats_to_png.js`，使用sharp库将SVG转换为PNG
  - 转换后的PNG图片尺寸为512x512，保持透明背景
  - FlagDetailPage.ets 已正确支持显示PNG格式的国徽
  - 转换脚本支持多种参数：
    - `--clean`: 转换后删除原SVG文件
    - `--force`: 强制重新转换已存在的PNG文件
    - `--retry`: 只转换之前失败的文件（kg, nl, rs）
  - 改进了转换脚本的错误处理，支持多种转换方法：
    - 自动处理UTF-16编码的SVG文件
    - 对于复杂SVG，自动尝试降低分辨率
    - 提供详细的错误信息和建议
- **历史国旗详情页UI优化**：改进历史国旗详情页的显示效果
  - 在左侧添加时间线效果（竖线和圆点），更清晰地展示时间顺序
  - 将国旗图片宽度调整为60%，使显示更紧凑
  - 减少每个单元格头部的高度（年份标签底部间距从12px减少到8px）
  - 将时间线上的圆点颜色改为主蓝色（button_primary），更加醒目
  - 减少单元格/行的整体高度：
    - 国旗图片高度从200px减少到120px
    - 单元格内边距从16px减少到12px
    - 图片底部间距从20px减少到8px
    - 行之间的间距从16px减少到12px
- **所有游戏关卡完成按钮优化**：将"再来一次"按钮改为"下一关"或"完美收官"
  - Quiz游戏：非最后一关显示"下一关"，最后一关显示"完美收官"，点击退出
  - FakeFlag游戏：非最后一关显示"下一关"，最后一关显示"完美收官"，点击退出
  - Input游戏：非最后一关显示"下一关"，最后一关显示"完美收官"，点击退出
  - Trivia游戏：非最后一关显示"下一关"，最后一关显示"完美收官"，点击退出
  - Memory游戏：非最后一关显示"下一关"，最后一关显示"完美收官"，点击退出
  - Paint游戏：非最后一关显示"下一关"，最后一关显示"完美收官"，点击退出
  - 点击"下一关"会自动跳转到下一关，点击"完美收官"会退出游戏

### 删除 (Removed)
- **删除无效的anthems目录**：删除了 `entry/src/main/resources/base/media/anthems` 目录（导致编译错误的无效路径）
- **清理未使用和重复文件**：删除了项目根目录下的未使用和重复文件
  - 删除了 `Flag_of_FIAV.svg 1.png`（重复文件，FIAV PNG已正确放置在 `entry/src/main/resources/base/media/flag_fiav.png`）
  - 删除了 `download_anthems.py`（未使用的Python脚本）
  - 删除了 `IconPark - Icons Pack (Community)/` 目录（未使用的图标包，占用11MB空间，项目使用app.media中的图标资源）
  - 删除了临时报告和评估文件：
    - `UNUSED_FILES_REPORT.md`
    - `CODE_REVIEW_2025-12-08_FULL.md`
    - `CODE_REVIEW_2025-12-08.md`
    - `PROJECT_EVALUATION.md`

### 修复
- **州旗列表页顶部区域间距优化**：修复州旗列表页顶部国家信息卡片的间距问题
  - 将顶部卡片的 padding 从 20 调整为 24，与专题详情页保持一致
  - 移除了顶部卡片的底部 margin，统一间距样式
  - 为网格添加顶部 padding（top: 16），修复网格没有顶部间距的问题
  - 参考 TopicDetailPage 的实现，保持页面样式一致性
- **涂鸦游戏WebView渐显效果**：为涂鸦游戏的WebView添加了平滑的渐显动画效果
  - 使用`animateTo` API替代`setTimeout`，实现更平滑的渐显动画
  - 添加了`transition`效果，动画时长400ms，使用`cubicBezier(0.42, 0, 0.58, 1)`缓动曲线（easeInOut效果）
  - WebView初始透明度为0，在页面加载完成并设置好背景色和游戏后，平滑渐显到完全不透明
  - 提升了用户体验，避免了WebView内容的突然出现
  - 修复了编译错误：使用`curves.cubicBezier`替代不存在的`curves.easeInOut`
- **涂鸦游戏深色模式检测优化**：改进了深色模式的检测和背景色处理
  - 新增`detectDarkMode()`方法，单独处理深色模式检测（参考injectSVG的方式）
  - 使用两种方法检测深色模式，按优先级：
    1. 读取保存的主题设置（Preferences）- 最可靠的方法
    2. 通过资源管理器检测系统主题（跟随系统模式时使用）
  - 在WebView页面加载完成时（onPageEnd）重新检测并更新背景色，确保获取最新的颜色模式
  - 根据深色模式正确设置背景色：深色模式使用`#1C1C1E`，浅色模式使用`#F5F6F7`
  - 确保背景色在设置游戏之前正确注入，避免背景色闪烁
  - 修复了编译错误：移除了不存在的`ApplicationContext.getColorMode()`方法调用
  - 添加了详细的调试日志，帮助诊断深色模式检测问题
  - 改进了系统主题检测逻辑，正确处理colorMode为0（浅色）和1（深色）的情况
- **移除探索页面历史国旗功能**：从探索页面移除了历史国旗卡片和相关功能
  - 移除了`hasAnyHistory`导入和`hasHistory`状态变量
  - 移除了历史国旗卡片UI和路由跳转
  - 简化了探索页面，只保留游戏相关功能
- **专题顺序调整**：将国际组织专题移到相似旗专题后面
- **FIAV旗帜显示**：修复旗帜学协会国际联盟（FIAV）旗帜显示问题
  - 修改getFlagImageSource函数，让FIAV使用PNG格式（与其他国际组织一致）
  - 移除了rawfile/flags目录下的fiav.svg文件
  - 添加了`flag_fiav.png`文件到`entry/src/main/resources/base/media/`目录
  - FIAV旗帜现在可以正常显示，不再变形

### 新增
- 在国旗详情页底部（国徽前面）添加历史国旗banner，使用Grid展示历史国旗，点击可进入历史国旗详情页

### 重大更新
- **历史国旗数据全面更新**：重新提取和下载所有历史国旗数据
  - 数据量从249条增加到1411条（增长466%）
  - 国家数量从53个增加到195个（覆盖所有大洲）
  - 包含法国、英国、美国、中国等所有主要国家
  - **修复提取逻辑**：从每个单元格中提取图片和年份（而不是从表头），确保图片和年份正确对应
  - 下载了1411张历史国旗图片（450个新下载，961个已存在，0个失败）
  - 修复了图片和年份不匹配的问题

### 修复
- 修复历史国旗数据加载时机问题，确保在设置国家信息后立即加载历史国旗数据
- 修复历史国旗提取脚本，改进法国和英国的国家名称匹配逻辑，确保能正确识别这些国家
  - 将法国和英国的匹配逻辑提前，优先匹配这些常见国家
- 修复阿联酋历史国旗顺序：将1968年和1200年的顺序调整为正确的历史时间线
- 修复历史国旗提取逻辑：从表格列标题提取年份，而不是从单元格内容中提取，确保图片和年份正确对应

### 优化
- 历史国旗详情页：移除国旗图片的容器和背景，让国旗直接显示，保持原始外观
- 历史国旗详情页：移除每个国旗下方的描述文本，只显示年份和国旗图片
- 历史国旗banner：移除"查看全部"文本，只保留箭头符号，箭头颜色与标题文本颜色一致

## [未发布]

### 修复 (Fixed)
- **国徽下载脚本**：修复下载脚本中缺失的14个国家代码
  - 添加了缺失的国家：ao (安哥拉)、cd (刚果(金))、cf (中非)、cg (刚果(布))、cm (喀麦隆)、cy (塞浦路斯)、dm (多米尼克)、ga (加蓬)、gq (赤道几内亚)、hu (匈牙利)、kn (圣基茨和尼维斯)、ng (尼日利亚)、st (圣多美和普林西比)、td (乍得)
  - 手动下载了dm和kn的国徽（API有数据但脚本未下载）
  - 手动添加了cd (刚果(金))的国徽文件（从项目根目录移动到media文件夹并重命名为coat_of_arms_cd.svg）
  - 当前共有198个国徽文件（195个国家中，195个都有国徽）
- **移除运行时下载功能**：由于所有国徽已预下载到media文件夹，移除了运行时下载相关代码
  - 从 `ProfilePage.ets` 中移除了下载所有国徽的设置项和相关UI
  - 移除了 `CoatOfArmsDownloader` 和 `CoatOfArmsDatabase` 的引用
  - 国徽现在完全通过 `coatOfArmsUtil.ets` 从本地资源加载，无需运行时下载

## [未发布]

### 新增 (Added)
- **旗帜学协会国际联盟**：添加旗帜学协会国际联盟（FIAV）到国际组织列表
  - 组织代码：`fiav`
  - 中文名称：旗帜学协会国际联盟
  - 英文名称：Fédération internationale des associations vexillologiques
  - 总部：休斯顿 / 伦敦
  - 网站：http://www.fiav.org
  - 简介：旗帜学协会国际联盟是致力于旗帜学研究与推广的国际组织，成立于1969年，由惠特尼·史密斯创立。拥有55个成员协会及组织，促进全球旗帜学知识的交流与发展。协会旗帜图案为一个接绳结。
- **国际组织网站信息**：为所有国际组织添加网站信息
  - 在 `InternationalOrg` 接口中添加 `website` 字段（可选）
  - 在国际组织详情页显示网站信息（不可点击的文本）
  - 在朗读内容和分享内容中包含网站信息
  - 已添加网站的组织：联合国、欧盟、奥林匹克、北约、东盟、非盟、阿盟、红十字会、旗帜学协会国际联盟
- **国际组织简介**：为所有国际组织添加简介信息
  - 在 `InternationalOrg` 接口中添加 `description` 字段（可选）
  - 在国际组织详情页显示简介（在网站信息下方）
  - 创建 `DescriptionItem` 方法用于显示多行文本简介
  - 在朗读内容和分享内容中包含简介信息
  - 已为所有9个国际组织添加了详细的简介内容

## [未发布]

### 新增功能 (Added)
- **国旗礼仪专题**：新增国旗礼仪与规范知识专题
  - 在专题列表中添加"国旗礼仪"专题，包含国旗在国际场合的使用规范和礼仪知识
  - 内容包括：升旗流程、悬挂顺序、悬挂方式、使用场合、礼仪规范、常见错误等6个部分
  - 专题详情页支持知识性内容展示，以滚动列表形式展示知识内容
  - 创建 `FlagEtiquetteData.ets` 数据文件，包含完整的国旗礼仪知识内容
  - 扩展专题系统，支持知识性专题（countryCodes为空数组时显示知识内容而非国旗列表）
- **国旗制作专题**：新增国旗制作知识专题
  - 在专题列表中添加"国旗制作"专题，包含国旗制作的完整知识体系
  - 内容包括：制作流程、制作材料、制作工艺、制作工厂、质量标准、制作成本等6个部分
  - 详细介绍国旗从设计到生产的全过程，包括材料选择、工艺技术、工厂资质等
  - 创建 `FlagManufacturingData.ets` 数据文件，包含完整的国旗制作知识内容
  - 优化知识性专题展示逻辑，支持多个知识性专题的展示
- **旗帜学专题**：新增旗帜学（国旗学）知识专题
  - 在专题列表中添加"旗帜学"专题，包含旗帜学的基础知识和研究方法
  - 内容包括：旗帜学概述、旗帜分类、设计原则、历史演变、研究方法、著名学者、旗帜象征等7个部分
  - 系统介绍旗帜学学科的定义、研究范围、分类体系、设计原则等核心内容
  - 创建 `FlagVexillologyData.ets` 数据文件，包含完整的旗帜学知识内容
  - 完善知识性专题系统，支持更多类型的知识内容展示
- **五星红旗历史专题**：新增五星红旗历史知识专题
  - 在专题列表中添加"五星红旗历史"专题，详细介绍五星红旗的历史
  - 内容包括：设计背景、设计过程、设计细节、首次升起、法律地位、使用规范、文化意义、历史演变等8个部分
  - 系统介绍五星红旗从设计到使用的完整历史，包括设计者曾联松、开国大典、国旗法等内容
  - 创建 `FlagHistoryData.ets` 数据文件，包含完整的五星红旗历史知识内容
  - 进一步扩展知识性专题系统，支持更多专题类型
- **蓝船旗专题**：新增蓝船旗（米字旗）专题
  - 在专题列表中添加"蓝船旗"专题，展示使用蓝船旗的英联邦国家
  - 蓝船旗来自英国的民用船旗，米字旗代表前英国殖民地，象征为英联邦成员
  - 包含国家：澳大利亚、新西兰、斐济、图瓦卢
  - 这些国家的国旗都包含英国米字旗（Union Jack）元素，体现其历史渊源
- **泛斯拉夫旗专题**：新增泛斯拉夫旗专题
  - 在专题列表中添加"泛斯拉夫旗"专题，展示采用泛斯拉夫色彩的国旗
  - 泛斯拉夫色彩为红、白、蓝三色，代表斯拉夫民族的团结
  - 包含国家：俄罗斯、塞尔维亚、斯洛伐克、斯洛文尼亚、克罗地亚、捷克
  - 这些国家的国旗都采用红、白、蓝三色组合，体现斯拉夫文化传统
- **泛中美洲联邦色旗专题**：新增泛中美洲联邦色旗专题
  - 在专题列表中添加"泛中美洲联邦色旗"专题，展示采用中美洲联邦色彩的国旗
  - 中美洲联邦国旗，蓝色代表加勒比海和太平洋，白色代表和平
  - 很多前中美洲联邦共和国的成员国采用这种色彩组合
  - 包含国家：萨尔瓦多、洪都拉斯、尼加拉瓜
  - 这些国家的国旗都采用蓝、白、蓝三色条纹设计，体现中美洲联邦的历史传统
- **泛米兰达色旗专题**：新增泛米兰达色旗专题
  - 在专题列表中添加"泛米兰达色旗"专题，展示采用米兰达色彩的国旗
  - 该旗为弗朗西斯科·德·米兰达于南美独立运动所用的旗帜
  - 其中红色代表南美洲，黄色代表西班牙，蓝色代表海
  - 后为前大哥伦比亚共和国的会员国采用
  - 包含国家：哥伦比亚、委内瑞拉、厄瓜多尔
  - 这些国家的国旗都采用黄、蓝、红三色组合，体现南美独立运动的历史渊源
- **相似旗专题**：新增相似旗专题
  - 在专题列表中添加"相似旗"专题，展示相似度较高的国旗
  - 一些国家的国旗相似度较高，仅在比例、颜色深度或细节上有所不同
  - 包含相似国旗组合：
    - 摩纳哥和印尼（红白横条，比例不同：4:5 vs 2:3）
    - 荷兰和卢森堡（红白蓝横条，比例和颜色深度不同）
    - 罗马尼亚和乍得（蓝黄红竖条，蓝色深度不同）
    - 中国和越南（红色底+五角星，星星数量不同）
    - 肯尼亚和南苏丹（色彩相似）
    - 安道尔和摩尔多瓦（竖条+徽章）
    - 伊朗和塔吉克斯坦（横条+徽章）
    - 爱尔兰和科特迪瓦（竖条，颜色顺序不同）
  - 包含国家：摩纳哥、印尼、荷兰、卢森堡、罗马尼亚、乍得、中国、越南、肯尼亚、南苏丹、安道尔、摩尔多瓦、伊朗、塔吉克斯坦、爱尔兰、科特迪瓦

### 优化 (Optimized)
- **专题页面滚动效果**：为专题列表页和专题详情页添加bounce滚动效果
  - 专题列表页（TopicListPage）的List组件添加Spring边缘效果
  - 专题详情页的国旗列表（FlagListView）使用Scroll包裹Grid，添加Spring边缘效果
  - 知识性专题内容列表已支持Spring边缘效果
- **文字类专题朗读功能**：为知识性专题添加朗读功能
  - 在专题详情页导航栏添加朗读按钮（仅知识性专题显示）
  - 支持朗读所有知识性专题内容，包括：国旗礼仪、国旗制作、旗帜学、五星红旗历史
  - 参考国旗详情页面的实现，使用TextReaderUtil进行文本朗读
  - 实现getReadContent方法，将所有章节内容组合为完整文本
  - 页面销毁时自动停止朗读，避免资源泄漏
  - 提供开始/停止朗读的交互反馈
- **国徽预下载和显示功能**：新增国徽预下载和显示功能
  - 创建 `scripts/download_coats_of_arms.js` 脚本，用于批量下载所有国家的国徽到media文件夹
  - 国徽文件保存为 `coat_of_arms_xx.svg` 格式（如 `coat_of_arms_cn.svg`），存储在 `entry/src/main/resources/base/media/` 目录
  - 创建 `coatOfArmsUtil.ets` 工具类，提供 `getCoatOfArmsImageSource()` 方法从media文件夹加载国徽资源
  - 在国旗详情页面顶部显示国徽（仅国家，不包括国际组织）
  - 国徽作为应用资源文件打包，无需运行时下载，提升加载速度
  - 使用 `$r('app.media.coat_of_arms_xx')` 方式引用国徽资源

### 调整 (Changed)
- **专题排序调整**：重新排序专题列表，文字类专题排在前面
  - 第一个：旗帜学
  - 第二个：国旗礼仪
  - 第三个：国旗制作
  - 第四个：五星红旗历史
  - 第五个：相似旗（特殊UI）
  - 其他专题按原有顺序排列
- **相似旗专题UI优化**：为相似旗专题创建独立UI展示
  - 每行显示两个相似国旗的组合
  - 顶部显示"xxx和xxx"的标题（如"摩纳哥和印尼"）
  - 两个国旗并排显示，点击可跳转到对应国旗详情页
  - 包含8组相似国旗：摩纳哥和印尼、荷兰和卢森堡、罗马尼亚和乍得、中国和越南、肯尼亚和南苏丹、安道尔和摩尔多瓦、伊朗和塔吉克斯坦、爱尔兰和科特迪瓦
  - 使用卡片式布局，提升视觉效果和用户体验

### 修复 (Fixed)
- **涂鸦游戏-美国州旗路径ID顺序修复**：修复多个美国州旗关卡无法完成的问题
  - 修正了得克萨斯州SVG文件中路径ID与颜色配置的对应关系
    - 调整了路径结构，使左侧竖条（蓝色）、右侧上半部分（白色）、右侧下半部分（红色）与颜色配置顺序匹配
  - 修正了爱荷华州SVG文件中路径ID顺序
    - 调整了路径结构，使左侧（蓝色）、中间（白色）、右侧（红色）与颜色配置顺序匹配
  - 修正了北卡罗来纳州SVG文件中路径ID顺序
    - 调整了路径结构，使左侧（蓝色）、上半部分（红色）、下半部分（白色）与颜色配置顺序匹配
  - 修正了田纳西州SVG文件中路径ID顺序
    - 添加了缺失的路径ID，使背景（红色）、右侧竖条（白色）、内部竖条（蓝色）与颜色配置顺序匹配
  - 修正了马萨诸塞州颜色配置
    - 更新颜色配置为两个颜色：白色（背景）和蓝色（中心盾牌）
    - SVG文件已包含正确的路径ID顺序（id="1"白色背景，id="2"蓝色中心）
  - 修正了俄亥俄州SVG文件中路径结构
    - 将右侧红色和白色条纹分开，使用group组织路径
    - id="1"包含所有红色部分（左侧三角形+右侧红色条纹）
    - id="2"包含蓝色中心圆形
    - 保持原有颜色配置不变：['BF0A30', 'FFFFFF', '002868']
  - 调整美国第4关配置
    - 从美国第4关移除俄亥俄州，现在只包含2个州旗：伊利诺伊州和密歇根州
  - 调整美国第5关配置
    - 从美国第5关移除北卡罗莱纳州，现在只包含2个州旗：佐治亚州和弗吉尼亚州
  - 调整美国第7关配置
    - 从美国第7关移除田纳西州，现在只包含2个州旗：印第安纳州和密苏里州
  - 调整美国第8关配置
    - 从美国第8关移除马里兰州，现在只包含2个州旗：威斯康星州和明尼苏达州
  - 修正明尼苏达州颜色配置和SVG路径结构
    - 添加白色背景和金色星星，现在包含三个颜色：蓝色、白色、金色
    - 颜色配置更新为：['001F5B', 'FFFFFF', 'FFD700']
    - 调整SVG路径ID顺序：id="1"蓝色三角形，id="2"白色背景，id="3"金色星星

## [1.0.7] - 2025-12-08

### 修复 (Fixed)
- **网络权限问题**：修复朗读功能选择官方声音（男声/女声）时提示"网络未连接"的问题
  - 在 `module.json5` 中添加 `ohos.permission.INTERNET` 网络权限
  - 添加网络权限使用说明字符串资源
  - 允许应用访问网络以下载语音模型和使用在线语音服务

### 优化 (Optimized)
- **涂鸦游戏暗黑模式**：优化涂鸦游戏在暗黑模式下的背景色
  - 暗黑模式下使用深黑色背景（#1C1C1E，非纯黑）
  - 浅色模式下保持灰色背景（#F5F6F7）
  - 根据系统主题自动切换背景色

## [未发布]

### 修复 (Fixed)
- **涂鸦游戏-美国州旗路径ID顺序修复**：修复多个美国州旗关卡无法完成的问题
  - 修正了得克萨斯州SVG文件中路径ID与颜色配置的对应关系
    - 调整了路径结构，使左侧竖条（蓝色）、右侧上半部分（白色）、右侧下半部分（红色）与颜色配置顺序匹配
  - 修正了爱荷华州SVG文件中路径ID顺序
    - 调整了路径结构，使左侧（蓝色）、中间（白色）、右侧（红色）与颜色配置顺序匹配
  - 修正了北卡罗来纳州SVG文件中路径ID顺序
    - 调整了路径结构，使左侧（蓝色）、上半部分（红色）、下半部分（白色）与颜色配置顺序匹配
  - 修正了田纳西州SVG文件中路径ID顺序
    - 添加了缺失的路径ID，使背景（红色）、右侧竖条（白色）、内部竖条（蓝色）与颜色配置顺序匹配

## [1.0.6] - 2025-12-08

### 新增功能 (Added)
- **HeadsUp 功能**：在探索页面新增 HeadsUp 游戏模式
  - 全屏显示，随机展示国旗
  - 点击屏幕查看答案，再次点击进入下一题
  - 每轮包含 10 个题目
  - 完成一轮后显示结束界面，可选择继续或退出
  - 支持多轮游戏，记录完成的轮数
- **专题新增**：在专题列表中添加太阳旗和星月旗专题
  - 太阳旗专题：包含 10 个国旗上绘有太阳图案的国家
  - 星月旗专题：包含 12 个国旗上绘有星月标志的国家

### 调整 (Changed)
- **专题顺序调整**：将太阳旗和星月旗专题移动到国旗上的动物专题之前
- **国旗上的动物专题**：从专题中移除玻利维亚、巴拉圭、秘鲁；添加塞尔维亚、黑山、埃及
- **涂鸦页面背景色优化**：涂鸦页面背景色固定为灰色（#F5F6F7），与页面背景色一致
- **国旗格式调整**：所有国家国旗统一使用SVG格式
  - 画廊页面和国旗详情页已支持PNG和SVG自动切换
  - 首页热门国旗和本周国旗已更新为支持PNG和SVG格式
  - 仅国际组织使用PNG格式，所有国家都使用SVG格式

### 优化 (Optimized)
- **专题详情页性能优化**：优化专题详情页列表渲染性能
  - 移除不必要的 setTimeout 延迟，改为同步加载数据
  - 使用 @Builder 提取 GridItem 内容，减少重复渲染
  - 为 ForEach 添加唯一 key 标识符，提升列表更新效率
  - 添加 Grid 缓存配置（cachedCount），提升滚动性能
  - 添加路由错误处理，提升稳定性

### 调整 (Changed)
- **关卡列表页UI调整**：移除所有关卡列表页中的emoji显示
  - 移除锁定状态的"🔒"emoji显示
  - 已解锁关卡仅显示箭头图标，未解锁关卡不显示任何图标
  - 涉及页面：看旗猜国名/看名猜国旗、知识问答、拼写挑战、记忆翻牌、假旗找茬

## [1.0.5] - 2025-12-08

### 代码审查 (Code Review)
- **全面代码审查**：重新进行了完整的代码审查和评测
  - 创建了 `CODE_REVIEW_2025-12-08.md` 完整审查报告
  - 审查范围：所有页面组件、工具类、数据管理和配置文件
  - 发现 8 个 Bug（高:2 中:4 低:2）
  - 发现 12 个优化建议（中:7 低:5）
  - 发现 3 个未完成功能（中:2 低:1）
  - 发现 10 个不一致性问题（低优先级）
  - 代码质量评分：3.5/5.0
  - 重点关注：定时器管理、资源清理、代码一致性

## [1.0.4] - 2025-12-08

### 新增功能 (Added)
- **州旗详情页朗读和分享功能**：为州旗详情页添加了朗读和分享功能
  - 在导航栏添加了朗读和分享按钮（参考国际组织详情页的设计）
  - 实现了 `onReadClick()` 方法，支持朗读州旗信息
  - 实现了 `onShareClick()` 方法，支持分享州旗信息到其他应用
  - 添加了 `getReadContent()` 方法，生成朗读内容
  - 添加了 `buildShareText()` 方法，生成分享文本
  - 朗读内容包括：州名、所属国家、首府、地区等信息
  - 分享内容包括：州名、所属国家、首府、地区等信息

### 修复 (Fixed)
- **编译错误修复**：修复了 ArkTS 编译错误
  - 修复了 `GameProgressManager.ets` 中 `throw` 语句的类型问题
  - 修复了 `ScreenshotManager.ets` 中 `throw` 语句的类型问题
  - ArkTS 要求 `throw` 必须是 `Error` 类型，已添加类型检查和转换

## [1.0.3] - 2025-12-08

### 代码审查 (Code Review)
- **全面代码审查**：完成了对整个项目的全面代码审查，生成了详细的审查报告
  - 创建了 `CODE_REVIEW_2025-12-08_FULL.md` 完整审查报告
  - 审查范围：所有页面组件、工具类、数据管理和配置文件
  - 发现 6 个 Bug（高:2 中:3 低:1）
  - 发现 15 个优化建议（中:8 低:7）
  - 发现 4 个未完成功能（中:3 低:1）
  - 发现 12 个不一致性问题（低优先级）
  - 提供了详细的修复建议和优先级分类
  - 代码质量评分：3.3/5

### 修复 (Fixed) - Bug 修复
- **FlagDetailPage doSaveFlag 缺少国际组织支持**：修复了保存国际组织旗帜时抛出错误的问题
  - `doSaveFlag()` 方法现在同时支持国家和国际组织
  - 修复后可以正常保存国际组织旗帜到相册

- **SaveFlagDialog 自动关闭时未释放 PixelMap**：修复了对话框自动关闭时 PixelMap 未释放的问题
  - 在 `handleClose()` 中确保调用 `onClose` 回调释放 PixelMap
  - 避免长时间使用导致的内存泄漏

- **MemoryPlayPage 定时器可能重复启动**：修复了定时器重复启动的问题
  - 在 `startTimer()` 中添加了检查，防止重复启动
  - 避免定时器重复执行导致的时间倒计时异常

- **GameProgressManager 初始化竞态条件**：修复了初始化失败后无法重试的问题
  - 在 `doInit` 失败时重置 `initPromise`，允许后续重试
  - 提升了初始化的健壮性

- **FavoritesManager 缺少错误重试机制**：改进了错误处理和重试逻辑
  - 在 `isFavorite()` 中添加了更好的错误处理和日志记录
  - 初始化失败后允许重试，提升用户体验

- **ScreenshotManager 文件描述符可能泄漏**：修复了文件描述符可能未正确关闭的问题
  - 使用更安全的资源管理模式，确保在所有情况下都能正确关闭文件描述符
  - 在写入成功后立即关闭，写入失败时也在 catch 中关闭
  - 避免大量保存操作导致文件描述符耗尽

### 优化 (Optimizations)
- **创建 PreferencesManager 减少重复初始化**：创建了统一的 Preferences 管理器
  - 新增 `PreferencesManager.ets` 工具类，提供统一的 Preferences 管理
  - 使用 Map 缓存已创建的 Preferences 实例，避免重复初始化
  - 更新了 `EntryAbility`、`ProfilePage` 和 `Index` 使用 PreferencesManager
  - 减少了 Preferences 的重复初始化，提升了性能和代码一致性

- **优化内存使用**：优化了 PixelMap 释放和大数组查找性能
  - 在 `FlagDetailPage.aboutToDisappear()` 中添加 PixelMap 释放，确保页面销毁时释放资源
  - 在 `onDownloadClick()` 中添加对话框关闭检查，避免重复创建对话框
  - 优化 `countryData.ets` 的查找性能：使用 Map 缓存替代数组查找（从 O(n) 优化到 O(1)）
  - 优化 `getCountryByCode()` 和 `getInternationalOrgByCode()` 的查找性能
  - 确保所有 PixelMap 在使用后正确释放，避免内存泄漏

### 修复 (Fixed)
- **ProfilePage 进度读取不一致**：修复了"我的"页面游戏进度显示始终为默认值1的问题
  - ProfilePage 现在使用 GameProgressManager 统一读取进度，而不是从错误的 preferences 文件读取
  - 修复后游戏进度能正确显示实际解锁的关卡数

- **FavoritesManager 初始化时序问题**：在 EntryAbility 中统一初始化收藏管理器和游戏进度管理器
  - 避免了在未初始化时调用导致的静默失败问题
  - 确保应用启动时所有管理器都已正确初始化

- **FlagDetailPage 内存泄漏风险**：修复了下载国旗时可能的内存泄漏
  - 在创建新的 PixelMap 之前先释放旧的 PixelMap
  - 避免用户多次点击下载导致的内存累积

- **TopicData 不存在的国家代码**：移除了北欧旗帜专题中不存在的国家代码
  - 移除了 'fo' (法罗群岛) 和 'ax' (奥兰群岛)，这些代码在 countryData 中不存在
  - 修复后专题详情页不再显示空白旗帜

- **PaintPlayPage 州旗图片路径**：修复了涂鸦游戏完成页面的州旗图片路径错误
  - LevelCompleteView 现在使用 getFlagImagePath() 方法获取正确的图片路径
  - 美国州旗正确使用 state_flags/us/ 目录

- **MemoryPlayPage timerId 类型**：修复了定时器 ID 类型不匹配的问题
  - 将 timerId 类型从 `number` 改为 `number | undefined`
  - 使用 `undefined` 替代 `-1` 作为未初始化状态

- **我的收藏入口无效**：修复了"我的"页面"我的收藏"菜单项点击无响应的问题
  - 添加了跳转到 FavoritesPage 的路由逻辑

- **下载图标深色模式不可见**：修复了下载图标在深色模式下不可见的问题
  - 创建了 `dark/media/icon_download.svg`，使用白色（#FFFFFF）描边

- **州旗详情页添加收藏和下载按钮**：优化了州旗详情页的用户体验
  - 在页面底部添加了收藏和下载按钮，与国旗详情页保持一致
  - 移除了顶部标题栏的下载按钮，简化界面
  - 收藏的州旗可以在"我的收藏"页面查看和跳转
  - 更新了 FavoritesPage 以支持州旗类型的收藏展示和导航

### 删除 (Removed)
- **清理财会相关未使用文件**：删除了与国旗小百科主题无关的财会工具页面和相关文件
  - 删除了 tools/ 目录下的所有37个财会工具页面（个税计算、五险一金、增值税、发票等）
  - 删除了 knowledge/ 目录下的知识库页面（内容为财会知识，与国旗无关）
  - 删除了 profile/ 目录下的 CityEditPage 和 InvoiceInfoPage
  - 删除了 components/ 目录下的 AmountInput 和 PageSeparatorSettings 组件
  - 删除了 utils/ 目录下的 cityData、invoiceInfoStore、knowledgeData、numberFormatter、pageSettings、provincesData 工具类
  - 更新了 main_pages.json，移除了已删除页面的路由配置
  - 更新了 FavoritesPage，移除了对知识库的依赖

## [1.0.2] - 2025-12-08

### 新增 (Added)
- **国旗涂鸦功能**：新增第三个Tab"涂鸦"，从 Flutter 项目移植国旗涂鸦游戏
  - `PaintGameData.ets` - 涂鸦游戏数据配置，包含国旗颜色信息和关卡配置
  - `PaintHomePage.ets` - 涂鸦首页，展示世界和各国州旗分类
  - `PaintPlayPage.ets` - 涂鸦游戏页面，使用 Web 组件加载 HTML 游戏
  - `paint_game.html` - HTML5 涂鸦游戏，支持颜色选择和区域填充
  - 支持分类：世界（20关）、美国、德国、意大利、巴西
  - 直接进入最新关卡，无需关卡选择页面
  - 每关包含3个国旗涂鸦任务
  - 支持提示功能（显示正确国旗参考）
  - 关卡进度自动保存

### 变更 (Changed)
- 更新 `Index.ets`：底部导航栏从4个Tab增加到5个Tab（首页、画廊、涂鸦、探索、我的）
- 更新 `GameProgressManager.ets`：新增涂鸦游戏类型枚举（PAINT_WORLD、PAINT_US等）
- 新增图标资源：`icon_tab_paint.svg`、`icon_tab_paint_selected.svg`、`icon_back.svg`、`icon_hint.svg`

## [1.0.1] - 2025-12-08

### 新增 (Added)
- **本周国旗功能**：首页新增"本周国旗"模块
  - `WeeklyFlagData.ets` - 每周国旗数据配置，包含最近10周的国庆日国旗
  - 根据当前周数自动展示对应国庆日的国家国旗
  - 展示国家名称、国庆日日期和描述
  - 点击可跳转至国旗详情页

## [1.0.0] - 2024-12-08

### 新增 (Added)
- **知识问答功能**：从 Flutter 项目移植知识问答游戏
  - `TriviaLevels.ets` - 关卡配置和问题数据（10关，每关10题）
  - `TriviaLevelsPage.ets` - 关卡选择页面
  - `TriviaPlayPage.ets` - 答题游戏页面
  - 问题类型涵盖国旗形状、颜色、图案、历史等趣味知识
  - 支持生命值系统、进度追踪、结果展示

- **专题功能**：新增国旗专题分类浏览
  - `TopicData.ets` - 专题数据配置
  - `TopicListPage.ets` - 专题列表页面
  - `TopicDetailPage.ets` - 专题详情页面（展示该专题下的所有国旗）
  - 内置专题：北欧旗帜、三色旗、泛阿拉伯旗帜、泛非洲旗帜、国旗上的动物
  - 首页添加专题推荐区域（横向滚动卡片）

### 重大变更 (Breaking Changes)
- **应用转型为国旗小百科**：将财会工具箱应用完全改造为国旗小百科应用
  - 更新应用名称为"国旗小百科"
  - 更新应用描述为"探索世界各国国旗的奥秘"
  - 更新底部导航栏：首页、画廊、探索、我的
  - 创建新的 GalleryPage（画廊页面）和 ExplorePage（探索页面）
  - 重写 HomePage 为国旗主题内容，包含：
    - 欢迎卡片（国旗小百科主题）
    - 快捷入口（全部国旗、按洲分类、国旗猜猜、收藏夹）
    - 热门国旗列表（中国、美国、日本、英国、法国）
    - 趣味小知识（10条国旗趣味知识）
  - 精简 ProfilePage，移除财会相关设置
  - 保留原有的颜色资源、工具类和应用结构

### 新增 (Added)
- **国旗画廊功能**：实现完整的国旗画廊页面
  - 从 flagame 项目复制了 195 个国家的国旗 SVG 文件到 `rawfile/flags/` 目录
  - 创建了 `countryData.ets` 数据文件，包含完整的国家信息（代码、中英文名称、首都、地区、人口、面积）
  - 实现洲际筛选功能：全部、亚洲、欧洲、非洲、美洲、大洋洲
  - 国旗网格展示（3列布局）
  - 点击国旗显示详情对话框，包含：国家名称、国旗大图、首都、地区、人口、面积
  - 人口和面积自动格式化显示（亿/万）

- **新增标签页图标**：使用 IconPark 图标包更新底部导航图标
  - 首页：home-two 图标
  - 画廊：picture-one 图标
  - 探索：compass-one 图标
  - 我的：user 图标
  - 每个图标都有普通（灰色 #8E8E93）和选中（蓝色 #1677FF + 浅蓝填充）两个版本
  - 同时创建了深色模式版本（普通白色，选中蓝色 + 深蓝填充）

---
